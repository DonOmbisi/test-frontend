import{a as pt,b as ct,c as ut,d as ft,e as Ct,f as _t,g as gt,h as ht,i as xt,j as bt,k as St,l as vt,m as Mt,n as Et,o as Pt}from"./chunk-GI5GYFP2.js";import{c as D}from"./chunk-QDJB5KD3.js";import{a as tt,b as et,c as nt}from"./chunk-OLDJ4PQL.js";import{B as Z,C as at,D as rt,S as lt,T as st,a as F,d as O,e as z,h as B,i as $,j as L,k as U,m as V,n as H,o as j,p as A,q as G,r as q,s as W,t as J,u as K,v as Q,w as X,x as Y}from"./chunk-JFJHP4L5.js";import{Ea as N,Fb as k,Ia as u,Ra as b,Sa as S,Wa as c,Xa as n,Ya as e,Za as v,_c as it,aa as w,ad as ot,ba as I,bb as f,bd as mt,cb as C,cd as dt,eb as R,gb as g,hb as E,jc as y,ua as m,vb as o,wb as _,ya as M,zb as T}from"./chunk-X42FMB2R.js";var It=()=>[10,20,50,100];function Nt(t,a){t&1&&(n(0,"mat-error"),o(1," Please enter a valid Student ID (positive number) "),e())}function Rt(t,a){t&1&&v(0,"mat-progress-bar",17)}function Tt(t,a){if(t&1&&(n(0,"div",18)(1,"p"),o(2),e()()),t&2){let r=E();m(2),T(" Showing ",r.currentPage*r.pageSize+1," - ",r.Math.min((r.currentPage+1)*r.pageSize,r.totalElements)," of ",r.totalElements.toLocaleString()," students ")}}function kt(t,a){t&1&&(n(0,"th",33),o(1,"Student ID"),e())}function yt(t,a){if(t&1&&(n(0,"td",34),o(1),e()),t&2){let r=a.$implicit;m(),_(r.studentId)}}function Dt(t,a){t&1&&(n(0,"th",33),o(1,"First Name"),e())}function Ft(t,a){if(t&1&&(n(0,"td",34),o(1),e()),t&2){let r=a.$implicit;m(),_(r.firstName)}}function Ot(t,a){t&1&&(n(0,"th",33),o(1,"Last Name"),e())}function zt(t,a){if(t&1&&(n(0,"td",34),o(1),e()),t&2){let r=a.$implicit;m(),_(r.lastName)}}function Bt(t,a){t&1&&(n(0,"th",33),o(1,"Date of Birth"),e())}function $t(t,a){if(t&1&&(n(0,"td",34),o(1),e()),t&2){let r=a.$implicit;m(),_(r.dob)}}function Lt(t,a){t&1&&(n(0,"th",33),o(1,"Class"),e())}function Ut(t,a){if(t&1&&(n(0,"td",34),o(1),e()),t&2){let r=a.$implicit;m(),_(r.className)}}function Vt(t,a){t&1&&(n(0,"th",33),o(1,"Score"),e())}function Ht(t,a){if(t&1&&(n(0,"td",34),o(1),e()),t&2){let r=a.$implicit;m(),_(r.score)}}function jt(t,a){t&1&&v(0,"tr",35)}function At(t,a){t&1&&v(0,"tr",36)}function Gt(t,a){if(t&1){let r=R();n(0,"div",19)(1,"table",21),f(2,22),u(3,kt,2,0,"th",23)(4,yt,2,1,"td",24),C(),f(5,25),u(6,Dt,2,0,"th",23)(7,Ft,2,1,"td",24),C(),f(8,26),u(9,Ot,2,0,"th",23)(10,zt,2,1,"td",24),C(),f(11,27),u(12,Bt,2,0,"th",23)(13,$t,2,1,"td",24),C(),f(14,28),u(15,Lt,2,0,"th",23)(16,Ut,2,1,"td",24),C(),f(17,29),u(18,Vt,2,0,"th",23)(19,Ht,2,1,"td",24),C(),u(20,jt,1,0,"tr",30)(21,At,1,0,"tr",31),e(),n(22,"mat-paginator",32),g("page",function(s){w(r);let i=E();return I(i.onPageChange(s))}),e()()}if(t&2){let r=E();m(),c("dataSource",r.students),m(19),c("matHeaderRowDef",r.displayedColumns),m(),c("matRowDefColumns",r.displayedColumns),m(),c("length",r.totalElements)("pageSize",r.pageSize)("pageSizeOptions",k(7,It))("pageIndex",r.currentPage)}}function qt(t,a){t&1&&(n(0,"div",20)(1,"p"),o(2,"No students found matching the current filters."),e()())}var ge=(()=>{let a=class a{constructor(l,s,i){this.fb=l,this.http=s,this.snackBar=i,this.students=[],this.displayedColumns=["studentId","firstName","lastName","dob","className","score"],this.currentPage=0,this.pageSize=20,this.totalElements=0,this.isLoading=!1,this.isExporting=!1,this.Math=Math,this.filterForm=this.fb.group({studentId:["",[this.validateStudentId.bind(this)]],className:[""]})}validateStudentId(l){let s=l.value;if(!s)return null;let i=Number(s);return isNaN(i)||i<=0?{invalidStudentId:!0}:null}ngOnInit(){this.loadStudents()}applyFilters(){if(this.filterForm.invalid){this.snackBar.open("Please fix the form errors before applying filters","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["error-snackbar"]});return}this.currentPage=0,this.loadStudents()}loadStudents(){this.isLoading=!0;let l=this.filterForm.value.studentId,s=l&&!isNaN(Number(l))?Number(l):void 0,i={page:this.currentPage,size:this.pageSize,studentId:s,className:this.filterForm.value.className||void 0},d=new URLSearchParams;d.set("page",i.page.toString()),d.set("size",i.size.toString()),i.studentId!==void 0&&d.set("studentId",i.studentId.toString()),i.className&&d.set("className",i.className),this.http.get(`http://localhost:8081/api/reports/students?${d.toString()}`).subscribe({next:p=>{p.success&&(this.students=p.students,this.totalElements=p.totalElements,this.currentPage=p.currentPage,this.pageSize=p.pageSize),this.isLoading=!1},error:p=>{this.snackBar.open("Error loading students: "+(p.message||"Unknown error"),"Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["error-snackbar"]}),this.isLoading=!1}})}onPageChange(l){this.currentPage=l.pageIndex,this.pageSize=l.pageSize,this.loadStudents()}exportToExcel(){if(this.filterForm.invalid){this.snackBar.open("Please fix the form errors before exporting","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["error-snackbar"]});return}this.exportData("excel")}exportToCsv(){if(this.filterForm.invalid){this.snackBar.open("Please fix the form errors before exporting","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["error-snackbar"]});return}this.exportData("csv")}exportToPdf(){if(this.filterForm.invalid){this.snackBar.open("Please fix the form errors before exporting","Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["error-snackbar"]});return}this.exportData("pdf")}exportData(l){this.isExporting=!0;let s=this.filterForm.value.studentId,i=s&&!isNaN(Number(s))?Number(s):void 0,d={page:this.currentPage,size:this.pageSize,studentId:i,className:this.filterForm.value.className||void 0};this.http.post(`http://localhost:8081/api/reports/export/${l}`,d).subscribe({next:p=>{p.success?(this.downloadFile(p.filePath,l),this.snackBar.open(`${l.toUpperCase()} report generated successfully!`,"Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"bottom"})):this.snackBar.open(`Error generating ${l.toUpperCase()} report: `+p.message,"Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["error-snackbar"]}),this.isExporting=!1},error:p=>{this.snackBar.open(`Error generating ${l.toUpperCase()} report: ${p.message||"Unknown error"}`,"Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["error-snackbar"]}),this.isExporting=!1}})}downloadFile(l,s){let i=l.split("/").pop()||l.split("\\").pop()||`report.${s}`;this.http.get(`http://localhost:8081/api/reports/download/${encodeURIComponent(i)}`,{responseType:"blob"}).subscribe({next:d=>{let p="application/octet-stream",h=s;switch(s){case"excel":p="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",h="xlsx";break;case"csv":p="text/csv",h="csv";break;case"pdf":p="application/pdf",h="pdf";break}let wt=new Blob([d],{type:p}),P=window.URL.createObjectURL(wt),x=document.createElement("a");x.href=P,x.download=i.endsWith(`.${h}`)?i:`${i}.${h}`,document.body.appendChild(x),x.click(),document.body.removeChild(x),window.URL.revokeObjectURL(P)},error:d=>{this.snackBar.open(`Error downloading ${s.toUpperCase()} file: ${d.message}`,"Close",{duration:5e3,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["error-snackbar"]})}})}};a.\u0275fac=function(s){return new(s||a)(M(H),M(y),M(lt))},a.\u0275cmp=N({type:a,selectors:[["app-reports"]],decls:55,vars:9,consts:[[1,"container"],[1,"filter-section",3,"ngSubmit","formGroup"],[1,"filter-row"],["appearance","outline"],["matInput","","formControlName","studentId","placeholder","Search by Student ID","type","number","min","1"],[4,"ngIf"],["formControlName","className"],["value",""],["value","Class1"],["value","Class2"],["value","Class3"],["value","Class4"],["value","Class5"],["mat-raised-button","","color","primary","type","submit"],[1,"export-section"],[1,"export-buttons"],["mat-raised-button","","color","accent",3,"click","disabled"],["mode","indeterminate",1,"progress-bar"],[1,"results-summary"],[1,"table-container"],[1,"no-data"],["mat-table","",1,"student-table",3,"dataSource"],["matColumnDef","studentId"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","firstName"],["matColumnDef","lastName"],["matColumnDef","dob"],["matColumnDef","className"],["matColumnDef","score"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions","pageIndex"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(s,i){if(s&1&&(n(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),o(4,"Reports Module"),e(),n(5,"mat-card-subtitle"),o(6,"View, filter, and export student data"),e()(),n(7,"mat-card-content")(8,"form",1),g("ngSubmit",function(){return i.applyFilters()}),n(9,"div",2)(10,"mat-form-field",3)(11,"mat-label"),o(12,"Student ID"),e(),v(13,"input",4),u(14,Nt,2,0,"mat-error",5),e(),n(15,"mat-form-field",3)(16,"mat-label"),o(17,"Class"),e(),n(18,"mat-select",6)(19,"mat-option",7),o(20,"All Classes"),e(),n(21,"mat-option",8),o(22,"Class1"),e(),n(23,"mat-option",9),o(24,"Class2"),e(),n(25,"mat-option",10),o(26,"Class3"),e(),n(27,"mat-option",11),o(28,"Class4"),e(),n(29,"mat-option",12),o(30,"Class5"),e()()(),n(31,"button",13)(32,"mat-icon"),o(33,"search"),e(),o(34," Apply Filters "),e()()(),n(35,"div",14)(36,"h3"),o(37,"Export Options"),e(),n(38,"div",15)(39,"button",16),g("click",function(){return i.exportToExcel()}),n(40,"mat-icon"),o(41,"table_chart"),e(),o(42," Export to Excel "),e(),n(43,"button",16),g("click",function(){return i.exportToCsv()}),n(44,"mat-icon"),o(45,"description"),e(),o(46," Export to CSV "),e(),n(47,"button",16),g("click",function(){return i.exportToPdf()}),n(48,"mat-icon"),o(49,"picture_as_pdf"),e(),o(50," Export to PDF "),e()()(),b(51,Rt,1,0,"mat-progress-bar",17),b(52,Tt,3,3,"div",18),b(53,Gt,23,8,"div",19),b(54,qt,3,0,"div",20),e()()()),s&2){let d;m(8),c("formGroup",i.filterForm),m(6),c("ngIf",(d=i.filterForm.get("studentId"))==null||d.errors==null?null:d.errors.invalidStudentId),m(25),c("disabled",i.isExporting),m(4),c("disabled",i.isExporting),m(4),c("disabled",i.isExporting),m(4),S(i.isLoading||i.isExporting?51:-1),m(),S(i.totalElements>0?52:-1),m(),S(i.students.length>0?53:-1),m(),S(!i.isLoading&&i.students.length===0?54:-1)}},dependencies:[j,B,F,$,O,z,V,A,L,U,Q,G,W,K,J,q,tt,Z,X,Y,nt,et,Mt,vt,D,ot,it,St,pt,ut,gt,ft,ct,ht,Ct,_t,xt,bt,Pt,Et,rt,at,st,dt,mt],styles:[".container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.filter-section[_ngcontent-%COMP%]{margin-bottom:24px}.filter-row[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center;flex-wrap:wrap}.filter-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{min-width:200px}.export-section[_ngcontent-%COMP%]{margin:24px 0;padding:16px;background-color:#f5f5f5;border-radius:4px}.export-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#333}.export-buttons[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap}.progress-bar[_ngcontent-%COMP%]{margin:16px 0}.results-summary[_ngcontent-%COMP%]{margin:16px 0;text-align:center;font-weight:500}.table-container[_ngcontent-%COMP%]{margin-top:24px;overflow-x:auto}.student-table[_ngcontent-%COMP%]{width:100%}.student-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .student-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 8px}.no-data[_ngcontent-%COMP%]{text-align:center;padding:48px;color:#666}mat-card[_ngcontent-%COMP%]{margin-bottom:24px}@media (max-width: 768px){.filter-row[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.filter-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{min-width:auto}.export-buttons[_ngcontent-%COMP%]{flex-direction:column}}"]});let t=a;return t})();export{ge as ReportsComponent};
